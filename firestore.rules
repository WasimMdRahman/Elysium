rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to user account documents. Only the user can read/write their own account.
     * @path /users/{userAccountId}
     * @allow (create) User with ID 'user123' can create their account document.
     * @allow (get) User with ID 'user123' can read their account document.
     * @allow (update) User with ID 'user123' can update their account document.
     * @allow (delete) User with ID 'user123' can delete their account document.
     * @deny (create) User with ID 'user456' cannot create an account document with ID 'user123'.
     * @deny (get) User with ID 'user456' cannot read user account document with ID 'user123'.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userAccountId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userAccountId) {
        return request.auth.uid == userAccountId;
      }

      function isExistingOwner(userAccountId) {
        return isOwner(userAccountId) && resource != null;
      }

      allow get: if isOwner(userAccountId);
      allow list: if false;
      allow create: if isSignedIn() && isOwner(userAccountId);
      allow update: if isExistingOwner(userAccountId);
      allow delete: if isExistingOwner(userAccountId);
    }

    /**
     * @description Controls access to user profile documents. Only the user can read/write their own profile.
     * @path /users/{userAccountId}/profile/{profileId}
     * @allow (create) User with ID 'user123' can create their profile.
     * @allow (get) User with ID 'user123' can read their profile.
     * @allow (update) User with ID 'user123' can update their profile.
     * @allow (delete) User with ID 'user123' can delete their profile.
     * @deny (create) User with ID 'user456' cannot create a profile for user 'user123'.
     * @deny (get) User with ID 'user456' cannot read the profile of user 'user123'.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userAccountId}/profile/{profileId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userAccountId) {
        return request.auth.uid == userAccountId;
      }

       function isExistingOwner(userAccountId) {
        return isOwner(userAccountId) && resource != null;
      }

      allow get: if isOwner(userAccountId);
      allow list: if false;
      allow create: if isSignedIn() && isOwner(userAccountId);
      allow update: if isExistingOwner(userAccountId);
      allow delete: if isExistingOwner(userAccountId);
    }

    /**
     * @description Controls access to mood entry documents. Only the user can read/write their own mood entries.
     * @path /users/{userAccountId}/mood_entries/{moodEntryId}
     * @allow (create) User with ID 'user123' can create a mood entry.
     * @allow (get) User with ID 'user123' can read their mood entry.
     * @allow (update) User with ID 'user123' can update their mood entry.
     * @allow (delete) User with ID 'user123' can delete their mood entry.
     * @allow (list) User with ID 'user123' can list their mood entries.
     * @deny (create) User with ID 'user456' cannot create a mood entry for user 'user123'.
     * @deny (get) User with ID 'user456' cannot read a mood entry of user 'user123'.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userAccountId}/mood_entries/{moodEntryId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userAccountId) {
        return request.auth.uid == userAccountId;
      }

      function isExistingOwner(userAccountId) {
        return isOwner(userAccountId) && resource != null;
      }

      allow get: if isOwner(userAccountId);
      allow list: if isOwner(userAccountId);
      allow create: if isSignedIn() && isOwner(userAccountId);
      allow update: if isExistingOwner(userAccountId);
      allow delete: if isExistingOwner(userAccountId);
    }

    /**
     * @description Controls access to journal entry documents. Only the user can read/write their own journal entries.
     * @path /users/{userAccountId}/journal_entries/{journalEntryId}
     * @allow (create) User with ID 'user123' can create a journal entry.
     * @allow (get) User with ID 'user123' can read their journal entry.
     * @allow (update) User with ID 'user123' can update their journal entry.
     * @allow (delete) User with ID 'user123' can delete their journal entry.
     * @allow (list) User with ID 'user123' can list their journal entries.
     * @deny (create) User with ID 'user456' cannot create a journal entry for user 'user123'.
     * @deny (get) User with ID 'user456' cannot read a journal entry of user 'user123'.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userAccountId}/journal_entries/{journalEntryId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userAccountId) {
        return request.auth.uid == userAccountId;
      }

      function isExistingOwner(userAccountId) {
        return isOwner(userAccountId) && resource != null;
      }

      allow get: if isOwner(userAccountId);
      allow list: if isOwner(userAccountId);
      allow create: if isSignedIn() && isOwner(userAccountId);
      allow update: if isExistingOwner(userAccountId);
      allow delete: if isExistingOwner(userAccountId);
    }

    /**
     * @description Controls access to task documents. Only the user can read/write their own tasks.
     * @path /users/{userAccountId}/tasks/{taskId}
     * @allow (create) User with ID 'user123' can create a task.
     * @allow (get) User with ID 'user123' can read their task.
     * @allow (update) User with ID 'user123' can update their task.
     * @allow (delete) User with ID 'user123' can delete their task.
     * @allow (list) User with ID 'user123' can list their tasks.
     * @deny (create) User with ID 'user456' cannot create a task for user 'user123'.
     * @deny (get) User with ID 'user456' cannot read a task of user 'user123'.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userAccountId}/tasks/{taskId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userAccountId) {
        return request.auth.uid == userAccountId;
      }

      function isExistingOwner(userAccountId) {
        return isOwner(userAccountId) && resource != null;
      }

      allow get: if isOwner(userAccountId);
      allow list: if isOwner(userAccountId);
      allow create: if isSignedIn() && isOwner(userAccountId);
      allow update: if isExistingOwner(userAccountId);
      allow delete: if isExistingOwner(userAccountId);
    }

    /**
     * @description Controls access to thought documents. Only the user can read/write their own thoughts.
     * @path /users/{userAccountId}/thoughts/{thoughtId}
     * @allow (create) User with ID 'user123' can create a thought.
     * @allow (get) User with ID 'user123' can read their thought.
     * @allow (update) User with ID 'user123' can update their thought.
     * @allow (delete) User with ID 'user123' can delete their thought.
     * @allow (list) User with ID 'user123' can list their thoughts.
     * @deny (create) User with ID 'user456' cannot create a thought for user 'user123'.
     * @deny (get) User with ID 'user456' cannot read a thought of user 'user123'.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userAccountId}/thoughts/{thoughtId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userAccountId) {
        return request.auth.uid == userAccountId;
      }

      function isExistingOwner(userAccountId) {
        return isOwner(userAccountId) && resource != null;
      }

      allow get: if isOwner(userAccountId);
      allow list: if isOwner(userAccountId);
      allow create: if isSignedIn() && isOwner(userAccountId);
      allow update: if isExistingOwner(userAccountId);
      allow delete: if isExistingOwner(userAccountId);
    }

    /**
     * @description Controls access to mental health exercise documents. Public read, no write access.
     * @path /mental_health_exercises/{exerciseId}
     * @allow (get) Any user can read a mental health exercise.
     * @allow (list) Any user can list mental health exercises.
     * @deny (create) No one can create a mental health exercise.
     * @deny (update) No one can update a mental health exercise.
     * @deny (delete) No one can delete a mental health exercise.
     * @principle Public read access for exercises.
     */
    match /mental_health_exercises/{exerciseId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

     /**
     * @description Controls access to streak documents. Only the user can read/write their own streaks.
     * @path /users/{userAccountId}/streaks/{streakId}
     * @allow (create) User with ID 'user123' can create a streak.
     * @allow (get) User with ID 'user123' can read their streak.
     * @allow (update) User with ID 'user123' can update their streak.
     * @allow (delete) User with ID 'user123' can delete their streak.
     * @allow (list) User with ID 'user123' can list their streaks.
     * @deny (create) User with ID 'user456' cannot create a streak for user 'user123'.
     * @deny (get) User with ID 'user456' cannot read a streak of user 'user123'.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userAccountId}/streaks/{streakId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userAccountId) {
        return request.auth.uid == userAccountId;
      }

      function isExistingOwner(userAccountId) {
        return isOwner(userAccountId) && resource != null;
      }

      allow get: if isOwner(userAccountId);
      allow list: if isOwner(userAccountId);
      allow create: if isSignedIn() && isOwner(userAccountId);
      allow update: if isExistingOwner(userAccountId);
      allow delete: if isExistingOwner(userAccountId);
    }

    /**
     * @description Controls access to chat history documents. Only the user can read/write their own chat history.
     * @path /users/{userAccountId}/chat_history/{chatHistoryId}
     * @allow (create) User with ID 'user123' can create a chat history entry.
     * @allow (get) User with ID 'user123' can read their chat history entry.
     * @allow (update) User with ID 'user123' can update their chat history entry.
     * @allow (delete) User with ID 'user123' can delete their chat history entry.
     * @allow (list) User with ID 'user123' can list their chat history entries.
     * @deny (create) User with ID 'user456' cannot create a chat history entry for user 'user123'.
     * @deny (get) User with ID 'user456' cannot read a chat history entry of user 'user123'.
     * @principle Enforces document ownership for all operations.
     */
    match /users/{userAccountId}/chat_history/{chatHistoryId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userAccountId) {
        return request.auth.uid == userAccountId;
      }

      function isExistingOwner(userAccountId) {
        return isOwner(userAccountId) && resource != null;
      }

      allow get: if isOwner(userAccountId);
      allow list: if isOwner(userAccountId);
      allow create: if isSignedIn() && isOwner(userAccountId);
      allow update: if isExistingOwner(userAccountId);
      allow delete: if isExistingOwner(userAccountId);
    }
  }
}
